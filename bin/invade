#!/usr/bin/env sh

echo "Creating backup directories..."
[ ! -d "$HOME/backups" ] && mkdir "$HOME/backups"
[ ! -d "$HOME/backups/vim_backups" ] && mkdir "$HOME/backups/vim_backups"

cd
echo "Moving existing files to ~/backups and invading..."
for rcfile in $(find dotfiles -name "*rc" -and ! -ipath "*x11*") "dotfiles/vim" "dotfiles/mutt"; do
    base=`basename $rcfile`
    timestamp=`date +%s`

    if [ -e .$base ]; then
        mv .$base ~/backups/$base.$timestamp
        ln -s $rcfile .$base
    fi
done

echo "Creating local config files..."
touch dotfiles/bash/local
touch dotfiles/vim/local.vim

bundle_dir=$HOME/dotfiles/vim/bundle
if [ ! -e $bundle_dir/ctrlp.vim.git ]; then
    echo "Installing ctrlp for vim..."
    mkdir -p $bundle_dir
    cd $bundle_dir
    git clone git://github.com/kien/ctrlp.vim.git
fi

echo "Done !"
